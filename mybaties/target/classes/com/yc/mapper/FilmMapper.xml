<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yc.mapper.FilmMapper">

    <!--    List<Film>FindAll()
    id:唯一的，方便引用
    type:自定义规则的Java类型-->
    <resultMap id="myFilm" type="com.yc.entity.Film">
        <!--  自定义主键封装规则
            property指定实体类属性名
            column知道数据表的列-->
        <id property="fid" column="fid"/>
        <result property="fname" column="fname"/>
        <result property="actor" column="actor"/>
        <result property="tid" column="tid"/>
        <result property="price" column="price"/>
        <result property="director" column="director"/>
        <result property="filmType.tid"  column="tid"></result>
        <result property="filmType.tname" column="tname"></result>
    </resultMap>
    <select id="findAll" resultMap="myFilm">
        select fid,fname,t.tid,actor,director,price,fpic,tname from tb_film f  join tb_filmtype t on f.tid=t.tid
    </select>

    <!--    实现多表查>
       List<Film>finds()
        第一种关联查询-->
    <resultMap id="myFilm01" type="com.yc.entity.Film">
        <id property="fid" column="fid"/>
        <result property="fname" column="fname"/>
        <result property="actor" column="actor"/>
        <result property="price" column="price"/>
        <result property="director" column="director"/>
        <result property="tid" column="tid"/>
        <result property="filmType.tid"  column="tid"></result>
        <result property="filmType.tname" column="tname"></result>
    </resultMap>
    <select id="finds" resultMap="myFilm01">
        select fid,fname,f.tid,actor,director,price,fpic,tname from tb_film f  join tb_filmtype t on f.tid=t.tid
    </select>

    <!--    List<Film>finds1()
        关联查询另一种方式，用association-->
    <resultMap id="myFilm02" type="com.yc.entity.Film">
        <id property="fid" column="fid"/>
        <result property="fname" column="fname"/>
        <result property="actor" column="actor"/>
        <result property="price" column="price"/>
        <result property="director" column="director"/>
        <result property="tid" column="tid"/>
        <result property="fpic" column="fpic"/>
<!--        javaType="com.yc.entity.FilmType-->
        <association property="filmType" javaType="com.yc.entity.FilmType">
            <id column="tid" property="tid"/>
            <result column="tname" property="tname"/>
        </association>
    </resultMap>
<!--    List<Film>finds-->
    <select id="finds1" resultMap="myFilm02">
        select fid,fname,f.tid,actor,director,price,fpic,tname from tb_film f  inner join tb_filmtype t on f.tid=t.tid
    </select>


<!--    List<Film>finds();
        association进行分布查询
        1.fid查询电影信息
        2.根据电影信息的tid类型查看表的类型信息
        3.把查询结果设置到电影对象中
    -->
    <resultMap id="myfilm03" type="com.yc.entity.Film">
        <id property="fid" column="fid"/>
        <result property="fname" column="fname"/>
        <result property="actor" column="actor"/>
        <result property="tid" column="tid"/>
        <result property="price" column="price"/>
        <result property="director" column="director"/>
        <result property="fpic" column="fpic"/>
        <!--
        association 定义关联对象封装规则
        select表示当前属性调用select知道的方法查询的结果
        colunm将指定列的数据传递到方法中
        -->
        <association property="filmType"  select="com.yc.mapper.TypeMapper.findByTid"
                    column="tid">
        </association>
    </resultMap>

    <select id="findByFidStep" resultMap="myfilm03">
        select fid,tid,fname,director,actor,price,fpic from tb_film where fid=#{fid}
    </select>

    <resultMap id="myfilm04" type="com.yc.entity.Film">
        <id property="fid" column="fid"/>
        <result property="fname" column="fname"/>
        <result property="actor" column="actor"/>
        <result property="price" column="price"/>
        <result property="tid" column="tid"/>
        <result property="director" column="director"/>
        <result property="fpic" column="fpic"/>
<!--        选择器，这里根据tid选择，tid为1显示FilmType，为2不显示，这里两个暂时都为5，所以不会显示-->
        <discriminator javaType="Integer" column="tid" >
            <case value="1" resultType="com.yc.entity.Film">
                <association property="filmType"  select="com.yc.mapper.TypeMapper.findByTid"
                             column="tid">
                </association>
            </case>
            <case value="2" resultType="com.yc.entity.Film">
                <id property="fid" column="fid"/>
                <result property="fname" column="fname"/>
                <result property="actor" column="actor"/>
                <result property="price" column="price"/>
                <result property="tid" column="tid"/>
                <result property="director" column="director"/>
                <result property="fpic" column="fpic"/>
            </case>
        </discriminator>
    </resultMap>
<!--        List<Film>findByDis-->
    <select id="findByDis" resultMap="myfilm04">
        select fid,fname,tid,actor,director,price,fpic from tb_film
    </select>


</mapper>